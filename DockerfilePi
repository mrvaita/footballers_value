FROM debian:buster

RUN apt-get update -y && \
    apt-get install -y \
    python3.7 \
    python3-pip \
    python3.7-dev \
    libatlas-base-dev \
    git

# We copy just the requirements.txt first to leverage Docker cache
COPY ./requirements.txt /footballers_value/requirements.txt

WORKDIR /footballers_value

RUN python3 -m pip install -U pip && \
    python3 -m pip install -r requirements.txt --index-url https://www.piwheels.org/simple \
    python3 -m pip install numpy --index-url https://www.piwheels.org/simple

# Limit this copy exclusively to the necessary directories
COPY . /footballers_value
RUN chmod +x boot.sh

ENV FLASK_APP wsgi.py

RUN adduser --disabled-password footballers_value
RUN chown -R footballers_value:footballers_value ./
USER footballers_value

EXPOSE 5000
CMD ["./boot.sh"]
